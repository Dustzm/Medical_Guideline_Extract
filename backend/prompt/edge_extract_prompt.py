# 构造提示词（使用您提供的思维链提示词）
def build_prompt(text):
    """
    其他信息（不重要）抽取
    Args:
        text: 其他信息

    Returns: 结构化知识
    """
    prompt = """
你是一位专业的医学指南知识抽取专家。你的任务是对医学指南文档中的非核心内容进行知识抽取，包括基本信息、证据质量与推荐强度描述定义、其他信息和参考文献。请严格按照以下思维链步骤进行抽取，确保全面、准确、不遗漏。

## 完整性承诺
我承诺将完整抽取论文中的所有非核心内容，特别是：
1. 所有基本信息及其相关属性
2. 所有证据质量与推荐强度定义（包括表格和文本描述）
3. 所有其他信息（利益冲突声明、项目成员等）
4. 所有参考文献（无论数量多少）

我不会因篇幅限制而省略任何内容。如果内容过多，我将分批次输出，但确保所有信息都被完整呈现。

## 防遗漏自我监督提示
在执行过程中，我将不断自问以下问题，确保不遗漏任何实体：
1. 我是否已找到所有类型的非核心实体？
2. 对于每种类型的实体，我是否已找到所有实例？
3. 对于多值实体（如参考文献、作者等），我是否已找到所有值？
4. 所有实体间的关系是否都已正确建立？
5. 是否有任何实体因篇幅考虑而被省略？

如果发现任何遗漏，我将立即补充，确保最终输出的完整性。

## 思维链抽取步骤

### 第一步：整体理解与准备
首先，请通读整篇医疗指南论文，理解其整体结构和内容组织方式，并进行准备工作：

1. **理解论文结构**：
   - 识别论文的主要章节和各部分内容，特别关注：
     * 基本信息部分（开头部分）
     * 证据质量与推荐强度描述与定义部分
     * 核心内容部分（已分割处理）
     * 其他信息部分（核心内容之后，参考文献之前）
     * 参考文献部分（文档末尾）

2. **建立抽取优先级**：
   - 根据论文结构，标记非核心内容位置
   - 确定多值实体的位置和数量
   - 规划抽取顺序，确保重要内容优先

**在此步骤思考中：** "我已完成整体理解与准备，论文的非核心内容主要包含以下部分：[列出主要非核心内容章节]。抽取优先级已确定，重要内容位于[位置]。"

### 第二步：基本信息抽取
按照以下类别系统化地抽取基本信息：

#### 1. 基本信息抽取
- **property关系**：发布日期、出版机构、当前指南状态、指南类型分类、出版地、学科分类、第一作者、通讯作者、邮箱、其他作者、语种为…、中文标题、摘要、关键词、链接、总页数、致谢、伦理批准、数据可用性、作者贡献、基金来源、英文缩略语、参考文献
- **entityTag类型限定**：临床实践指南基本信息、研究者
- **valueTag类型限定**：临床实践指南基本信息、dateTime、Literal、指南状态、integer、anyURL、指南类型、地点、学科分类、研究者、邮箱、语种
- **第一作者（执笔人）抽取要求**：
  - 实体名保持为"基本信息"
  - 抽取值调整为"执笔人"
  - 将所有执笔人抽取在一行中，用逗号分隔
  - 示例：entity: "基本信息", property: "第一作者", value: "[执笔人1姓名],[执笔人2姓名],[执笔人3姓名]"
- **其他作者（项目核心成员）抽取要求**：
  - 实体名保持为"其他作者"
  - 抽取值调整为"项目核心成员"
  - 将所有项目核心成员抽取在一行中，用逗号分隔
  - 示例：entity: "基本信息", property: "其他作者", value: "[项目核心成员1姓名], [项目核心成员2姓名],[项目核心成员3姓名]"
- **通讯作者抽取要求**：
  - 首先抽取"基本信息"实体，property为"通讯作者"，value："通讯作者姓名"
  - 然后"通讯作者姓名"实体，property为"邮箱"，value："通讯作者的邮箱"
- **entityTag抽取要求**：
    - entityTag需要与entity对应，每个entityTag对应一个entity，例如：entity："基本信息"，entityTag："临床指南基本信息"
    - 所有基本信息实体的entityTag为"临床指南基本信息"
    - 只有通讯作者的entityTag为"研究者"，例如：entity："通讯作者姓名"，entityTag："研究者"
- **valueTag抽取要求**：
    - valueTag需要与value对应，每个valueTag对应一个value，例如：entity："通讯作者姓名"，property："邮箱"，valueTag："邮箱"
    - valueTag和value对应关系：发布日期 - dateTime，出版机构 - Literal，当前指南状态 - 指南状态，指南类型分类 - 指南类型，出版地 - 地点，学科分类 - 学科分类，第一作者 - 研究者，通讯作者 - 研究者，邮箱 - 邮箱，其他作者 - 研究者，语种为…- 语种，中文标题 - Literal，摘要 - Literal，关键词 - Literal，链接 - anyURL，总页数 - integer，致谢 - Literal，伦理批准 - Literal，数据可用性 - Literal，作者贡献 - Literal，基金来源 - Literal，英文缩略语 - Literal，参考文献-文献资料

#### 2. 背景信息抽取
- **property关系**：针对的疾病、主题、目的、流行病学、指南的目标人群、指南使用者、制定机构或起草单位、指南层次
    - 其中针对的疾病还有下层property：疾病分级标准、疾病分期标准、疾病分型标准、危险等级
- **entityTag类型限定**：临床实践指南背景、疾病
- **property-valueTag类型限定**：主题 - Literal，目的 - Literal，流行病学 - Literal，指南的目标人群 - 目标人群，指南使用者 - 指南使用人群，制定机构或起草单位 - 组织机构，指南层次 - Literal，疾病分级标准 - Literal，疾病分期标准 - Literal，疾病分型标准 - Literal，危险等级 - Literal
- **疾病抽取注意事项**：
    - 针对的疾病需要根据原文进行分级、分型、分期标准和危险等级的判断，可能不存在这些标准，如不存在的则不抽取，存在则抽取，抽取的value应为疾病。
 

#### 3. 方法学信息抽取
- **property关系**：临床问题的遴选和确定、证据检索的研究类型、证据检索的数据库、证据检索的其它途径、有… 利益冲突声明
- **entityTag类型限定**：临床实践指南制订方法
- **property-valueTag类型限定**：临床问题的遴选和确定 - Literal，证据检索的研究类型 - 临床研究设计类型，证据检索的数据库 - 数据库，证据检索的其它途径 - Literal，有… 利益冲突声明 - 非经济利益冲突声明，有… 利益冲突声明 - 经济利益冲突声明，有… 利益冲突声明 - 间接利益冲突声明
- **利益冲突说明**：有三种利益冲突，都需要提取
    - 非经济利益冲突声明
    - 经济利益冲突声明
    - 间接利益冲突声明

**临床问题的遴选和确定专项处理**：
1. 定位论文中关于临床问题遴选和确定的相关文本（通常在方法学部分）
2. 仔细阅读并理解相关内容，识别以下关键要素：
   - 遴选和确定的流程
   - 参与人员及其角色
   - 遴选标准和方法
   - 确定方法和依据
   - 优先级排序方法（如有）
   - 最终确定的临床问题数量及类型
3. 基于原文内容，进行专业、合理、逻辑清晰的总结概括：
   - 保持专业术语的准确性
   - 确保概括内容全面反映原文要点
   - 按照逻辑顺序组织内容（如：流程→方法→标准→结果）
   - 避免直接复制原文，而是用自己的话进行专业表达
4. 检查总结概括是否准确、完整、专业，如有不足，重新进行

**在此步骤思考中：** "我已完成基本信息抽取，发现的主要实体和关系如下：" [按照上述类别列出所有发现的实体和关系，并明确标注使用的关系]

### 第三步：证据质量与推荐意见抽取
按照以下方式抽取证据质量与推荐强度相关内容：

#### 1. 证据质量与推荐意见抽取
- **property关系**：制订主体、关注领域、制定方法学、有… 证据质量等级、推荐等级
- **entityTag类型限定**：证据质量与推荐意见分级标准
- **property-valueTag类型限定**：制订主体 - 组织机构，关注领域 - 医学学科，制定方法学 - 证据质量与推荐意见分级标准制订方法学，有… 证据质量等级 - 证据质量等级，推荐等级 - 推荐等级

#### 2. 表格内容专项处理
1. 定位论文中的证据质量与推荐强度相关表格（通常在方法学部分或专门章节中）
2. 完整提取表格内容，包括：
   - 表格标题
   - 表格结构（行、列标题）
   - 表格中的所有数据
   - 表格注释或说明
3. 如果有多个相关表格，分别提取并标注其关系
4. 确保表格内容与文本描述的一致性

#### 3. 推荐强度和证据等级处理说明
在处理推荐强度和证据等级时，按照以下规则进行：
1. **推荐强度处理**：
   - 从原文中抽取推荐强度代码（如1、2、0、-1、-2等）
   - 根据提取的定义，将代码映射为对应的说明文字
   - 例如：原文为"1（强推荐）、2（弱推荐）"，则推荐强度为"强推荐、弱推荐"

2. **证据等级处理**：
   - 从原文中抽取证据质量代码（如A、B、C、D等）
   - 直接使用代码字母，无需映射为说明文字
   - 例如：原文为"A（高质量）、B（中等质量）"，则证据等级为"A、B"

**在此步骤思考中：** "我已完成证据质量与推荐意见抽取，共发现[X]个相关表格，[Y]个定义描述。详细清单如下：" [列出所有证据质量与推荐意见相关内容]

### 第四步：参考文献专项处理
由于参考文献数量通常较多且结构一致，需进行专项处理：

#### 1. 参考文献定位与统计
1. 定位论文中的参考文献部分（通常在论文末尾）
2. 统计参考文献总数，并与原文中的声明数量核对
3. 确认参考文献的格式
4. 若原文的参考文献有序号，则在抽取时不得附带序号

#### 2. 参考文献逐条抽取
1. 按照原文顺序逐条抽取每篇参考文献的完整信息
2. 抽取参考文献时，若文献开头有参考文献序号，例如[1] xxxxxxxx，应去除序号[1]
3. 确保每篇参考文献都按照要求的格式输出：
   - entity: "基本信息"
   - property: "参考文献"
   - value: 完整的参考文献条目
   - entityTag: "临床实践指南基本信息"
   - valueTag: "文献资料"
   - level: 2
4. 如果参考文献有分组（如按章节分组），需保持分组结构
5. 确保不遗漏任何参考文献，不添加任何额外内容

#### 3. 参考文献格式一致性检查
1. 检查所有参考文献的格式是否一致
2. 确保参考文献中的标点符号、缩写等符合原文
3. 如有特殊格式的参考文献（如网站、书籍等），确保其格式正确

**在此步骤思考中：** "我已完成参考文献专项处理，参考文献共[X]篇。详细清单如下：" [列出所有参考文献]

### 第五步：完整性验证与关系构建
基于前几步的抽取结果，进行完整性验证和关系构建：

#### 1. 实体完整性验证
- **基本信息实体验证**：
  - 确认所有基本信息都已抽取
  - 确认作者信息完整（第一作者、其他作者、通讯作者等）
  - 确认背景信息和方法学信息完整

- **证据质量与推荐意见实体验证**：
  - 确认所有相关表格都已完整抽取
  - 确认所有定义描述都已准确抽取
  - 确认推荐强度和证据等级处理正确

- **其他信息实体验证**：
  - 确认所有利益冲突声明都已抽取
  - 确认所有项目成员信息都已抽取
  - 确认其他声明信息都已抽取

- **参考文献实体验证**：
  - 确认所有参考文献都已抽取，数量与原文一致
  - 确认参考文献格式正确，不编号

#### 2. 关系完整性验证
- **基本信息关系验证**：
  - 确认基本信息内部关系正确
  - 确认作者信息关系正确

- **证据质量与推荐意见关系验证**：
  - 确认表格与定义描述的关系正确
  - 确认推荐强度和证据等级的关系正确

- **其他信息关系验证**：
  - 确认利益冲突声明与项目成员的关系正确
  - 确认其他声明信息的关系正确

#### 3. 构建实体关系网络
1. 检查所有实体之间的关系是否正确使用了定义的property关系
2. 确保关系的层级结构正确，例如：
   - 基本信息 → 发布日期 → 具体日期
   - 证据质量与推荐意见分级标准 → 有…证据质量等级 →  具体描述
3. 确保多值实体（如参考文献、作者等）正确拆分为多行

**在此步骤思考中：** "我已完成完整性验证与关系构建，实体完整性[Z]%，关系完整性[Y]%。实体关系网络如下：" [以图形化方式展示主要实体间的关系]

### 第六步：格式化输出
将最终的抽取结果按照要求的格式进行输出：

#### 输出要求核心要点
1. 每行六列：entity、property、value、entityTag、valueTag、level
2. 多值实体拆分为多行
3. 空值保留字段，内容留空
4. 严格从原文抽取，不编造内容
5. 完整输出所有内容，不省略
6. 使用示例的格式
6. 不必输出entity、property、value、entityTag、valueTag、level这六个表头，直接输出内容即可

#### 特殊实体输出要求
- **第一作者（执笔人）**：
  - entity: "基本信息"
  - property: "第一作者"
  - value: "[执笔人1姓名],[执笔人2姓名],[执笔人3姓名], ..."（所有执笔人在一行，用逗号分隔）
  - entityTag: "临床实践指南基本信息"
  - valueTag: "第一作者"
  - level: 2

- **其他作者（项目核心成员）**：
  - entity: "基本信息"
  - property: "其他作者"
  - value: "[项目核心成员1姓名],[项目核心成员2姓名],[项目核心成员3姓名], ..."（所有项目核心成员在一行，用逗号分隔）
  - entityTag: "临床实践指南基本信息"
  - valueTag: "其他作者"
  - level: 2

- **通讯作者**：
  - entity: "基本信息"
  - property: "通讯作者"
  - value: "通讯作者"
  - entityTag: "临床实践指南基本信息"
  - valueTag: "研究者"
  - level: 2
  - entity: "通讯作者"
  - property: "邮箱"
  - value: "「通讯作者1邮箱」"
  - entityTag: "研究者"
  - valueTag: "邮箱"
  - level: 3

- **临床问题的遴选和确定**：
  - entity: "方法"
  - property: "临床问题的遴选和确定"
  - value: [专业总结概括的内容，非直接抽取]
  - entityTag: "临床实践指南制订方法"
  - valueTag: "Literal"
  - level: 2

- **参考文献**：
  - entity: "基本信息"
  - property: "参考文献"
  - value: [完整的参考文献条目]
  - entityTag: "临床实践指南基本信息"
  - valueTag: "文献资料"
  - level: 2

#### 输出格式示例
本指南			主实体		0
本指南	基本信息	基本信息	主实体	临床实践指南基本信息	1
基本信息	发布日期	2022年4月	临床实践指南基本信息	dateTime	2
基本信息	出版机构	中国中西医结合杂志	临床实践指南基本信息	Literal	2
基本信息	当前指南状态	现行	临床实践指南基本信息	指南状态	2
基本信息	指南类型分类	临床应用指南	临床实践指南基本信息	指南类型	2
基本信息	出版地	北京	临床实践指南基本信息	地点	2
基本信息	学科分类	中西医结合、骨科学	临床实践指南基本信息	学科分类	2
基本信息	第一作者	詹红生,章振林	临床实践指南基本信息	研究者	2
基本信息	通讯作者	詹红生	临床实践指南基本信息	研究者	2
詹红生	邮箱	zhanhongsheng2010@163.com	研究者	邮箱	3
基本信息	其他作者	张伯礼,陈可冀,高学敏,田金洲,李幼平,陈香美,张俊华,房书亭,王桂华,孙媛媛等	临床实践指南基本信息	研究者	2
基本信息	语种为…	中文	临床实践指南基本信息	语种	2
基本信息	中文标题	中成药治疗骨质疏松症临床应用指南（2021年）	临床实践指南基本信息	Literal	2
基本信息	摘要	未明确提及	临床实践指南基本信息	Literal	2
基本信息	关键词	未明确提及	临床实践指南基本信息	Literal	2
基本信息	链接	DOI：10.7661/j.cjim.20220204.063	临床实践指南基本信息	anyURL	2
基本信息	总页数	12	临床实践指南基本信息	integer	2
基本信息	致谢	未明确提及	临床实践指南基本信息	Literal	2
基本信息	伦理批准	未明确提及	临床实践指南基本信息	Literal	2
基本信息	数据可用性	未明确提及	临床实践指南基本信息	Literal	2
基本信息	作者贡献	未明确提及	临床实践指南基本信息	Literal	2
基本信息	基金来源	国家中医药管理局《中成药治疗优势病种临床应用指南》标准化项目（No.SATCM-2015-BZ402）	临床实践指南基本信息	Literal	2
基本信息	英文缩略语	OP（骨质疏松症）、POP（原发性骨质疏松症）、PMOP（绝经后骨质疏松症）、SOP（老年性骨质疏松症）、OPF（骨质疏松性骨折）、RCT（随机对照试验）等	临床实践指南基本信息	Literal	2
基本信息	参考文献	陈芳，张宜，徐立，等. 中西医治疗绝经后骨质疏松症的研究进展［J］. 医药导报，2021，40（9）：1216-1220.	临床实践指南基本信息	文献资料	2
基本信息	参考文献	中华人民共和国国家统计局. 中国统计年鉴［M］.北京：中国统计出版社，2015：2-16.	临床实践指南基本信息	文献资料	2
基本信息	参考文献	夏维波，章振林，林华，等.原发性骨质疏松症诊疗指南（2017）［J］.中国骨质疏松杂志，2019，25（3）：281-309.	临床实践指南基本信息	文献资料	2
本指南	有…背景	背景	主实体	临床实践指南背景	1
背景	针对的疾病	骨质疏松症(OP)	临床实践指南背景	疾病	2
背景	主题	中成药治疗骨质疏松症	临床实践指南背景	主题	2
背景	目的	为临床医生合理、规范使用中成药提供参考和指导	临床实践指南背景	目的	2
背景	流行病学	中国60岁以上人口已超过2.1亿（约占总人口的15.5%），65岁以上人口近1.4亿（约占总人口的10.1%），是世界上老年人口绝对数最大的国家。随着人口老龄化日趋严重，OP已成为我国面临的重要公共健康问题。	临床实践指南背景	流行病学	2
背景	指南的目标人群	骨质疏松症患者，包括低骨量患者、PMOP患者、SOP患者、POP患者（临床无法明确区分的人群）、OPF患者	临床实践指南背景	指南的目标人群	2
背景	指南使用者	临床医生	临床实践指南背景	指南使用者	2
背景	制定机构或起草单位	《中成药治疗优势病种临床应用指南》标准化项目组，由中国中药协会负责实施，由上海中医药大学附属曙光医院和上海交通大学附属第六人民医院共同牵头	临床实践指南背景	制定机构或起草单位	2
背景	指南层次	国家	临床实践指南背景	指南层次	2
骨质疏松症(OP)	疾病分型标准	骨量减少患 者、绝经后骨质疏松症（postmenopausal osteoporosis， PMOP）、老年性骨质疏松症（senile osteoporosis， SOP）、骨质疏松性骨折（osteoporotic fracture，OPF）	疾病	Literal
本指南	方法	方法	主实体	临床实践指南制订方法	1
方法	临床问题的遴选和确定	指南工作组通过专家共识法，经过四轮问卷调查，对全国25省、直辖市、自治区，61家三级医院、7家二级医院、11家社区医院，西医专家76名，中医专家14名，中西医结合专家10名，普通人群（非医学专业人群，包括骨质疏松症患者和非骨质疏松症患者）1401名进行调研，最终确定临床研究问题和结局指标。根据问卷调查结果和专家、普通人群补充问题，最终确定了5个临床研究问题和临床重要结局指标。临床问题的结构采用PICO（participants，intervention，control，outcome）原则进行结构化设置：P为低骨量、原发性骨质疏松症患者；I为中成药单独使用或联合其他方法；C为单独使用西药/西医常规治疗、公认有效的中成药、安慰剂等；O为重要结局指标：骨密度值、骨折风险评分、疼痛评分等。临床研究问题重要性评分采用Likert 5级评分法进行测量，结局指标重要性排序采用9分法。	临床实践指南制订方法	Literal	2
方法	证据检索的研究类型	系统评价、Meta分析与指南	临床实践指南制订方法	临床研究设计类型	2
方法	证据检索的数据库	中国生物医学文献数据库（SinoMed）、万方全文数据库（WanFang DATA）、中国知网（CNKI）、中文科技期刊全文数据库（VIP）、PubMed、MEDLINE、NGC、Cochrane Library、EmBase	临床实践指南制订方法	数据库	2
方法	证据检索的其它途径	专家问卷调查、检索国家药监局网站、查阅《中华人民共和国药典》2010版中临床用药须知—中药成方制剂卷	临床实践指南制订方法	Literal	2
方法	有…利益冲突声明	非经济利益冲突声明：在正式参与制定相关工作前，所有成员均签署利益冲突声明，声明无任何与本部指南主题相关的商业的、专业的或其他方面的利益，和所有可能被本指南成果影响的利益。	临床实践指南制订方法	非经济利益冲突声明	2
方法	有…利益冲突声明	经济利益冲突声明：在正式参与制定相关工作前，所有成员均签署利益冲突声明，声明无任何与本部指南主题相关的商业的、专业的或其他方面的利益，和所有可能被本指南成果影响的利益。	临床实践指南制订方法	经济利益冲突声明	2
方法	有…利益冲突声明	间接利益冲突声明：无潜在利益冲突。在正式参与制定相关工作前，所有成员均签署利益冲突声明，声明无任何与本部指南主题相关的商业的、专业的或其他方面的利益，和所有可能被本指南成果影响的利益。	临床实践指南制订方法	间接利益冲突声明	2
本指南	的	证据质量与推荐意见分级标准	主实体	证据质量与推荐意见分级标准	1
证据质量与推荐意见分级标准	制订主体	GRADE工作组	证据质量与推荐意见分级标准	组织机构	2
证据质量与推荐意见分级标准	关注领域	医学	证据质量与推荐意见分级标准	医学学科	2
证据质量与推荐意见分级标准	制定方法学	GRADE方法	证据质量与推荐意见分级标准	证据质量与推荐意见分级标准制订方法学	2
证据质量与推荐意见分级标准	有…证据质量等级	高质量(A)：未来研究几乎不可能改变现有疗效评价结果的可信度；中等质量(B)：未来研究可能对现有疗效评估有重要影响，可能改变评价结果的可信度；低质量(C)：未来研究很有可能对现有疗效评估有重要影响，改变评价结果可信度的可能性大；极低质量(D)：任何的疗效评估都很不确定	证据质量与推荐意见分级标准	证据质量等级	2
证据质量与推荐意见分级标准	推荐等级	支持使用某种疗法的强推荐(↑↑)：强推荐1；支持使用某种疗法的弱推荐(↑?)：弱推荐2；不能确定(0)：暂不推荐0；反对使用某种疗法的强推荐(↓↓)：反对-1；反对使用某种疗法的弱推荐(↓?)：不建议-2	证据质量与推荐意见分级标准	推荐等级	2


#### 输出声明

**直接按照示例格式输出，不要添加任何文字说明或声明。**

## 执行说明
1. 请严格按照上述思维链步骤进行抽取，不要跳过任何步骤。
2. 在每个步骤完成后，请输出该步骤的结果，然后再进行下一步。
3. 确保抽取过程系统化、全面化，避免遗漏任何重要信息。
4. 特别注意property关系的正确使用。
5. 特别注意证据质量与推荐强度表格的完整抽取。
6. 严格遵守输出格式要求，确保结果准确、规范。
7. 整个过程中，保持专业严谨的态度，确保抽取的医疗信息准确无误。
8. 当抽取的property的值在原文不存在时，则不抽取，不添加任何关系。
9. 最终输出时，只按照示例输出内容，不添加任何文字说明或声明。

## 最终输出指示
完成所有步骤后，直接输出格式化内容，不要添加任何文字说明、声明或总结。输出结果应包含所有抽取的实体和关系，确保完整性和准确性。

现在，请根据上述思维链步骤，从提供的医疗指南论文中提取非核心内容的知识实体与关系。
    """
    prompt = f"""
        {prompt}
        待抽取的文本：
        {text[:100000]}
        """
    return prompt